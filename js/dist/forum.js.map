{"version":3,"sources":["webpack://@fof/secure-https/webpack/bootstrap","webpack://@fof/secure-https/./forum.js","webpack://@fof/secure-https/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/secure-https/./src/forum/components/PostImage.js","webpack://@fof/secure-https/./src/forum/index.js","webpack://@fof/secure-https/external \"flarum.core.compat['Component']\"","webpack://@fof/secure-https/external \"flarum.core.compat['components/CommentPost']\"","webpack://@fof/secure-https/external \"flarum.core.compat['extend']\""],"names":["PostImage","view","props","url","title","alt","Component","app","initializers","add","regExp","extend","CommentPost","prototype","content","post","contentHtml","proxy","forum","attribute","match","newContent","exec","encodeURIComponent","replace","m","prop"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import Component from 'flarum/Component';\n\nexport default class PostImage extends Component {\n    view() {\n        const { url, title, alt } = this.props;\n\n        return <img src={url} title={title} alt={alt} />\n    }\n}","import { extend } from 'flarum/extend';\nimport CommentPost from 'flarum/components/CommentPost';\nimport PostImage from \"./components/PostImage\";\n\napp.initializers.add('fof/secure-https', () => {\n    const regExp = /<img src=\"http:\\/\\/(.+)\" title=\"(.*)\" alt=\"(.*)\">/g;\n\n    extend(CommentPost.prototype, 'init', function() {\n        const content = this.props.post.contentHtml();\n        const proxy = app.forum.attribute('fof-secure-https.proxy');\n\n        if (proxy) {\n            let match;\n            let newContent = content;\n\n            while ((match = regExp.exec(content)) !== null) {\n                match[1] = encodeURIComponent(match[1]);\n                match[1] = match[1].replace('%2F', '%252F'); //Apache Support\n\n                newContent = newContent.replace(\n                    match[0],\n                    `<img src=\"${app.forum.attribute('apiUrl')}/fof/secure-https/${match[1]}\" title=\"${match[2]}\" alt=\"${match[3]}\">`\n                );\n            }\n\n            this.props.post.contentHtml = m.prop(newContent);\n        } else {\n            let match;\n            let newContent = content;\n            //\n            // while ((match = regExp.exec(content))) {\n            //     const url = match[1];\n            //     const item = <PostImage url={match[1]} title={match[2]} alt={match[3]} />\n            //\n            //     newContent = newContent.replace(\n            //         match[0],\n            //         `<${item.tag} ${Object.entries(item).map(([key, value]) => `${key}=${value}`)}>`\n            //     )\n            // }\n            //\n            // this.props.post.contentHtml = m.prop(newContent);\n\n            // this.props.post.contentHtml = m.prop(\n            //     //I know this is a mess, this is the shortest way to achieve this. There's a TON of escaping that happened lol\n            //     this.props.post.contentHtml().replace(\n            //         /<img src=\"http:\\/\\/(.+)\" title=\"(.*)\" alt=\"(.*)\">/g,\n            //         // console.log(<img src=\"https://$1\" />)\n            //         '<img onerror=\"$(this).next().empty().append(\\'<blockquote style=&#92;&#39;background-color: #c0392b; color: white;&#92;&#39; class=&#92;&#39;uncited&#92;&#39;><div><p>'+app.translator.trans('fof-secure-https.forum.removed')+'| <a href=&#92;&#39;#&#92;&#39; style=&#92;&#39;color:white;&#92;&#39;onclick=&#92;&#39;window.open(&#92;&#34;http://{@src}&#92;&#34;,&#92;&#34;name&#92;&#34;,&#92;&#34;width=600,height=400&#92;&#34;)&#92;&#39;>'+app.translator.trans('fof-secure-https.forum.show')+'</a></p></div></blockquote>\\');$(this).hide();\" onload=\"$(this).next().empty();\" class=\"securehttps-replaced\" src=\"https://$1\" title=\"{@title}\" alt=\"{@alt}\"><span><br><br><i class=\"icon fa fa-spinner fa-spin fa-3x fa-fw\"></i> Loading Image<br></span>'\n            //     )\n            // );\n        }\n    });\n});\n","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['components/CommentPost'];","module.exports = flarum.core.compat['extend'];"],"sourceRoot":""}